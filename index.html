<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Votre Aventure Geek au Japon — Itinéraire interactif</title>
  <!-- Icons & Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <style>
    /* =====================
       DESIGN SYSTEM
    ======================*/
    :root {
      --primary: #db2b52;           /* rouge framboise chic */
      --primary-600: #c31f45;
      --secondary: #3b82f6;         /* bleu punchy */
      --bg: #0b1220;                /* fond night */
      --bg-elev: #0f172a;           /* carte */
      --text: #e5ebff;              /* texte clair */
      --muted: #a7b0c3;             /* texte secondaire */
      --card: rgba(17, 24, 39, .65);/* verre */
      --border: rgba(255,255,255,.08);
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --shadow-soft: 0 6px 20px rgba(2,6,23,.2);
      --radius-xl: 18px;
      --radius-lg: 14px;
      --radius-md: 12px;
      --blur: 10px;
      --ring: 0 0 0 2px rgba(219,43,82,.25), 0 8px 30px rgba(219,43,82,.25);
    }

    /* Light theme (auto if user toggles) */
    html[data-theme="light"] {
      --bg: #f6f7fb;
      --bg-elev: #ffffff;
      --text: #0b1220;
      --muted: #4b5563;
      --card: rgba(255,255,255,.75);
      --border: rgba(15, 23, 42, .08);
      --shadow-soft: 0 6px 24px rgba(2,6,23,.08);
    }

    * { box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body {
      margin: 0; font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1200px 800px at 20% -10%, rgba(219,43,82,.14), transparent 50%),
                  radial-gradient(1000px 700px at 90% 10%, rgba(59,130,246,.12), transparent 50%),
                  var(--bg);
      color: var(--text);
      line-height: 1.65;
    }

    /* =====================
       HEADER / HERO
    ======================*/
    .site-header {
      position: sticky; top: 0; z-index: 50; backdrop-filter: saturate(150%) blur(10px);
      background: linear-gradient(90deg, rgba(11,18,32,.75), rgba(11,18,32,.35));
      border-bottom: 1px solid var(--border);
    }
    .nav {
      max-width: 1100px; margin: 0 auto; padding: .8rem 1rem; display: flex; align-items: center; gap: 1rem;
      justify-content: space-between;
    }
    .brand { display: flex; align-items: center; gap: .65rem; font-weight: 800; letter-spacing: .2px; }
    .brand i { color: var(--primary); }
    .nav-actions { display: flex; align-items: center; gap: .5rem; }
    .btn, .chip {
      display: inline-flex; align-items: center; gap: .5rem; border: 1px solid var(--border); color: var(--text);
      padding: .6rem .9rem; border-radius: 999px; text-decoration: none; font-weight: 600; transition: .2s ease; cursor: pointer;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0));
    }
    .btn:hover { transform: translateY(-1px); box-shadow: var(--shadow-soft); }
    .btn.primary { background: linear-gradient(180deg, var(--primary), var(--primary-600)); border-color: transparent; color: white; }
    .btn.ghost { background: transparent; }

    .hero { position: relative; overflow: hidden; }
    .hero-inner {
      max-width: 1100px; margin: 0 auto; padding: 3.8rem 1rem 2.6rem; display: grid; grid-template-columns: 1.2fr .8fr; gap: 2rem; align-items: center;
    }
    @media (max-width: 980px) { .hero-inner { grid-template-columns: 1fr; padding-top: 2.2rem; } }
    .hero h1 { font-size: clamp(1.9rem, 3.2vw + 1rem, 3.2rem); line-height: 1.1; margin: .2rem 0 1rem; letter-spacing: .1px; }
    .eyebrow { color: var(--muted); font-weight: 700; text-transform: uppercase; letter-spacing: .18em; font-size: .78rem; }
    .hero .lede { font-size: clamp(1rem, .5vw + .9rem, 1.15rem); color: var(--muted); margin-bottom: 1.4rem; }
    .hero-cta { display: flex; gap: .6rem; flex-wrap: wrap; }

    .hero-art { position: relative; isolation: isolate; }
    .glassy {
      background: var(--card); backdrop-filter: blur(var(--blur)) saturate(125%);
      border: 1px solid var(--border); border-radius: var(--radius-xl); box-shadow: var(--shadow-soft);
    }
    .hero-card { padding: 1.2rem; display: grid; grid-template-columns: 1fr 1fr; gap: .8rem; }
    .hero-metric { padding: 1rem; border-radius: var(--radius-lg); border: 1px dashed var(--border); }
    .hero-metric .lbl { font-size: .8rem; color: var(--muted); }
    .hero-metric .val { font-weight: 800; font-size: 1.4rem; }

    /* Scroll progress */
    .progress { position: fixed; inset: 0 0 auto 0; height: 3px; background: linear-gradient(90deg, var(--primary), var(--secondary)); transform-origin: 0 0; scale: 0 1; z-index: 60; }

    /* =====================
       SECTIONS WRAPPER
    ======================*/
    .container { max-width: 1100px; margin: 0 auto; padding: 1.6rem 1rem 3rem; }
    .section { margin-top: 2.4rem; }
    .section h2 { font-size: clamp(1.1rem, .9vw + .9rem, 1.8rem); margin: 0 0 1rem; display: flex; align-items: center; gap: .6rem; }
    .section h2 i { color: var(--primary); }

    /* Tabs / quick nav */
    .tabs { display: flex; gap: .5rem; flex-wrap: wrap; margin-top: .4rem; }
    .chip { font-size: .9rem; }
    .chip.active, .chip:hover { box-shadow: var(--ring); }

    /* Cards */
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 1rem; }
    .col-12 { grid-column: span 12; }
    .col-6 { grid-column: span 6; }
    .col-4 { grid-column: span 4; }
    .col-3 { grid-column: span 3; }
    @media (max-width: 980px) { .col-6 { grid-column: span 12; } .col-4 { grid-column: span 12; } .col-3 { grid-column: span 6; } }

    .card { border: 1px solid var(--border); border-radius: var(--radius-xl); background: var(--card); backdrop-filter: blur(var(--blur)); box-shadow: var(--shadow-soft); padding: 1.2rem; }
    .card h3 { margin: 0 0 .6rem; font-size: 1.2rem; }
    .muted { color: var(--muted); }

    /* Itinerary grid */
    .itinerary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1rem; }
    .day-card { position: relative; border: 1px solid var(--border); border-radius: var(--radius-lg); background: var(--card); backdrop-filter: blur(var(--blur));
      box-shadow: var(--shadow-soft); overflow: hidden; cursor: pointer; transition: transform .15s ease, box-shadow .15s ease; }
    .day-card:hover { transform: translateY(-4px); box-shadow: 0 16px 40px rgba(2,6,23,.18); }
    .day-head { display: flex; align-items: center; justify-content: space-between; padding: .75rem 1rem; border-bottom: 1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,0)); }
    .day-head .badge { font-weight: 800; color: white; background: linear-gradient(135deg, var(--primary), var(--secondary)); padding: .3rem .6rem; border-radius: 10px; font-size: .8rem; }
    .day-body { padding: 1rem; display: grid; gap: .4rem; }
    .day-body .title { font-weight: 700; }
    .day-body .kicker { font-size: .9rem; color: var(--muted); }

    /* Details panels */
    .details { display: none; margin-top: 1rem; border-left: 3px solid var(--primary); }
    .details.visible { display: block; animation: fadeIn .35s ease; }
    @keyframes fadeIn { from { opacity: 0; translate: 0 -6px; } to { opacity: 1; translate: 0 0; } }

    .row { display: grid; grid-template-columns: repeat(12, 1fr); gap: .8rem; }
    .row > * { grid-column: span 12; }
    @media (min-width: 860px) { .row > .half { grid-column: span 6; } }

    .tag { display: inline-flex; align-items: center; gap: .45rem; font-size: .85rem; padding: .35rem .6rem; border: 1px solid var(--border); border-radius: 999px; color: var(--muted); }
    .tag i { color: var(--muted); }

    table { width: 100%; border-collapse: collapse; }
    th, td { padding: .75rem .6rem; border-bottom: 1px solid var(--border); text-align: left; }
    thead th { color: var(--muted); font-weight: 700; }
    tfoot td { font-weight: 800; color: var(--primary); border-top: 2px solid var(--primary); }

    .notice { padding: .9rem 1rem; border-radius: var(--radius-md); border: 1px solid var(--border); background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0)); }
    .notice.warning { border-left: 4px solid var(--warning); }
    .notice.success { border-left: 4px solid var(--success); }

    /* Back to top */
    #backToTopBtn {
      position: fixed; right: 18px; bottom: 18px; z-index: 60; border: 1px solid var(--border); padding: .8rem; border-radius: 50%;
      background: var(--card); backdrop-filter: blur(var(--blur)); color: var(--text); cursor: pointer; box-shadow: var(--shadow-soft); display: none;
    }
    #backToTopBtn:hover { box-shadow: 0 14px 40px rgba(2,6,23,.2); transform: translateY(-2px); }

    /* Print */
    @media print {
      body { background: white; color: #000; }
      .site-header, .hero, .tabs, #backToTopBtn, .progress { display: none !important; }
      .details { display: block !important; }
      .card, .day-card { box-shadow: none !important; background: white !important; backdrop-filter: none !important; }
      a:after { content: " (" attr(href) ")"; font-size: 9pt; color: #555; }
    }
  </style>
</head>
<body>
  <!-- Scroll progress bar -->
  <div class="progress" id="progressBar"></div>

  <!-- Header / Nav -->
  <header class="site-header">
    <nav class="nav">
      <div class="brand"><i class="fa-solid fa-cherry-blossom"></i><span>Japon — Itinéraire Geek</span></div>
      <div class="nav-actions">
        <button class="btn ghost" id="themeToggle" title="Basculer clair/sombre"><i class="fa-regular fa-moon"></i><span class="hide-sm">&nbsp;Thème</span></button>
        <a class="btn" href="#itineraire"><i class="fa-regular fa-map"></i> Voir l’itinéraire</a>
        <button class="btn primary" onclick="window.print()"><i class="fa-solid fa-file-arrow-down"></i> PDF</button>
      </div>
    </nav>
  </header>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-inner">
      <div>
        <div class="eyebrow">Tokyo comme base • 3 semaines</div>
        <h1>Votre Aventure Geek au Japon <span style="color:var(--primary)">— moderne & interactive</span></h1>
        <p class="lede">Un itinéraire ultra-détaillé (coûts, logistique, culture pop). Basculez en clair/sombre, filtrez par difficulté, dépliez jour par jour. Conçu pour être <strong>imprimable</strong> et <strong>mobile-friendly</strong>.</p>
        <div class="hero-cta">
          <a href="#budget" class="btn"><i class="fa-solid fa-coins"></i> Budget global</a>
          <a href="#ressources" class="btn ghost"><i class="fa-solid fa-link"></i> Ressources utiles</a>
        </div>
      </div>
      <div class="hero-art">
        <div class="hero-card glassy">
          <div class="hero-metric">
            <div class="lbl">Durée</div>
            <div class="val">21 jours</div>
          </div>
          <div class="hero-metric">
            <div class="lbl">Base</div>
            <div class="val">Tokyo 🗼</div>
          </div>
          <div class="hero-metric">
            <div class="lbl">Période idéale</div>
            <div class="val">Oct → Nov</div>
          </div>
          <div class="hero-metric">
            <div class="lbl">Geek-o-mètre</div>
            <div class="val">🔥🔥🔥🔥</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <main class="container">
    <!-- Quick nav / filters -->
    <div class="section">
      <div class="tabs" aria-label="filtres">
        <button class="chip active" data-filter="all"><i class="fa-solid fa-layer-group"></i> Tout</button>
        <button class="chip" data-filter="tokyo"><i class="fa-solid fa-city"></i> Tokyo</button>
        <button class="chip" data-filter="courte"><i class="fa-solid fa-person-walking"></i> Courtes</button>
        <button class="chip" data-filter="longue"><i class="fa-solid fa-train"></i> Longues</button>
        <button class="chip" data-filter="extreme"><i class="fa-solid fa-bolt"></i> Marathon</button>
      </div>
    </div>

    <!-- BUDGET -->
    <section id="budget" class="section">
      <h2><i class="fa-solid fa-coins"></i> Budget total estimé (2 pers.)</h2>
      <div class="card">
        <p class="muted">Hypothèse taux ~170 ¥ pour 1€.</p>
        <div class="row">
          <div class="half">
            <table>
              <thead><tr><th>Poste</th><th>Détail</th><th>€</th></tr></thead>
              <tbody>
                <tr><td>✈️ Avion</td><td>900€ / pers.</td><td>1 800€</td></tr>
                <tr><td>🏨 Hébergement</td><td>20 nuits ~130€/nuit</td><td>2 600€</td></tr>
                <tr><td>🚄 JR Pass</td><td>21 jours (2×100 000 ¥)</td><td>~1 200€</td></tr>
                <tr><td>🍱 Sur place</td><td>Budgets journaliers</td><td>~1 432€</td></tr>
                <tr><td>🎁 Extras</td><td>~15%</td><td>~1 050€</td></tr>
              </tbody>
              <tfoot><tr><td colspan="2">Total</td><td>~8 082€</td></tr></tfoot>
            </table>
          </div>
          <div class="half">
            <div class="notice warning"><strong>Important :</strong> Un seul hôtel à Tokyo ⇒ plusieurs journées très longues. Des alternatives sont proposées plus bas (double base Tokyo + Kansai).
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- RESSOURCES -->
    <section id="ressources" class="section">
      <h2><i class="fa-solid fa-link"></i> Ressources utiles</h2>
      <div class="grid">
        <div class="col-6">
          <div class="card">
            <ul>
              <li class="tag"><i class="fa-solid fa-train-subway"></i> <a href="https://www.japanrailpass.net/fr/" target="_blank">JR Pass — site officiel</a></li>
              <li class="tag"><i class="fa-solid fa-wifi"></i> <a href="https://www.japan-wireless.com/" target="_blank">Pocket Wifi — Japan Wireless</a></li>
              <li class="tag"><i class="fa-regular fa-clock"></i> <a href="https://world.navitime.com/fr/japan-travel/" target="_blank">Horaires — Navitime</a></li>
              <li class="tag"><i class="fa-solid fa-box"></i> <a href="https://www.kuronekoyamato.co.jp/ytc/en/" target="_blank">Takkyubin — Yamato</a></li>
              <li class="tag"><i class="fa-solid fa-water"></i> <a href="https://www.tide-forecast.com/locations/Miyajima/tides/latest" target="_blank">Marées — Miyajima</a></li>
            </ul>
          </div>
        </div>
        <div class="col-6">
          <div class="card">
            <h3>Checklist essentielle</h3>
            <ul>
              <li class="tag"><i class="fa-regular fa-calendar-check"></i> 3–4 mois : vols + hôtel Tokyo</li>
              <li class="tag"><i class="fa-solid fa-ticket"></i> 2–3 mois : Ghibli (ventes le 10)</li>
              <li class="tag"><i class="fa-solid fa-utensils"></i> 1 mois : cafés à thème</li>
              <li class="tag"><i class="fa-solid fa-sim-card"></i> 1 mois : JR Pass + Pocket Wifi</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- ITINERAIRE -->
    <section id="itineraire" class="section">
      <h2><i class="fa-regular fa-map"></i> Aperçu de l’itinéraire (cliquez pour déplier)</h2>
      <div class="itinerary-grid" id="grid">
        <!-- Template example (repeat with data-filter)
        <article class="day-card" data-target="#jour1" data-tags="tokyo">
          <div class="day-head"><span class="badge">Jour 1</span><span class="muted"><i class="fa-solid fa-location-dot"></i> Tokyo</span></div>
          <div class="day-body"><div class="title">Arrivée & Shinjuku</div><div class="kicker"><i class="fa-solid fa-plane-arrival"></i> Immersion</div></div>
        </article>
        -->
      </div>

      <!-- DETAILS (reprise et simplification de votre contenu original) -->
      <div id="details"></div>
    </section>

    <!-- RÉCAP SPEND -->
    <section class="section">
      <h2><i class="fa-solid fa-chart-simple"></i> Dépenses quotidiennes estimées (par personne)</h2>
      <div class="card" id="spendTable"></div>
    </section>

    <!-- Conseils / Alternatives -->
    <section class="section">
      <h2><i class="fa-regular fa-lightbulb"></i> Conseils pro & alternatives</h2>
      <div class="card">
        <p class="muted">Astuce majeure : <strong>diviser le séjour</strong> entre Tokyo et Kyoto/Osaka pour économiser 5–6h/jour lors des longues excursions Kansai.</p>
        <ul>
          <li class="tag"><i class="fa-solid fa-theater-masks"></i> Kabuki (billet 1 acte — abordable)</li>
          <li class="tag"><i class="fa-solid fa-robot"></i> Odaiba (Gundam, Miraikan, teamLab)</li>
          <li class="tag"><i class="fa-solid fa-hot-tub-person"></i> Super sento (Spa LaQua / Thermae-Yu)</li>
          <li class="tag"><i class="fa-solid fa-mountain"></i> Mont Takao (nature à 1h)</li>
        </ul>
      </div>
    </section>
  </main>

  <button id="backToTopBtn" title="Retour en haut"><i class="fas fa-arrow-up"></i></button>

  <script>
    // ===== Data (condensée depuis votre HTML original) =====
    const DAYS = [
      { id: 'jour1', num: 1, title: 'Arrivée & Shinjuku', place: 'Tokyo', icon: 'fa-plane-arrival', tag: 'tokyo', html: `
        <div class="card details"><h3><i class="fas fa-plane-arrival"></i> Jour 1 — Arrivée & Shinjuku</h3>
          <p>Arrivée (NRT/HND), activation JR Pass, pocket Wi‑Fi, installation à Shinjuku. Néons & énergie.</p>
          <div class="notice success"><strong>Geek :</strong> Yodobashi/Bic Camera Shinjuku pour l'électronique.</div>
          <div class="row">
            <div class="half card"><h4>Transport</h4><p><strong>N'EX</strong> Narita → Shinjuku (~90min) — <span class="tag"><i class="fa-solid fa-check"></i> JR Pass</span></p></div>
            <div class="half card"><h4>Budget du jour (pp)</h4><p>Dîner Omoide Yokocho ~3 500¥ • Boissons ~1 500¥ • Wi‑Fi ~500¥<br><strong>Total :</strong> ~5 500¥ (~35€)</p></div>
          </div>
        </div>` },
      { id: 'jour2', num: 2, title: 'Asakusa & Ueno', place: 'Tokyo', icon: 'fa-gopuram', tag: 'tokyo', html: `
        <div class="card details"><h3><i class="fas fa-gopuram"></i> Jour 2 — Asakusa & Ueno</h3>
          <p>Sensō‑ji, parc d'Ueno, marché Ameyoko.</p>
          <div class="notice"><strong>Geek :</strong> Yamashiroya (figurines) + arcades Taito.</div>
          <div class="row">
            <div class="half card"><h4>Transport</h4><p>JR Yamanote/Chuo‑Sobu (majoritairement couverts)</p></div>
            <div class="half card"><h4>Budget</h4><p>~5 400¥ (~34€)</p></div>
          </div>
        </div>` },
      { id: 'jour3', num: 3, title: 'Harajuku & Shibuya', place: 'Tokyo', icon: 'fa-street-view', tag: 'tokyo', html: `
        <div class="card details"><h3><i class="fas fa-street-view"></i> Jour 3 — Harajuku & Shibuya</h3>
          <p>Meiji Jingu, mode à Harajuku, Shibuya Crossing. Option: Shibuya Sky (réservation).</p>
          <div class="notice"><strong>Geek :</strong> Nintendo Store, Pokémon Center, Mandarake, arcades.</div>
          <div class="row"><div class="half card"><h4>Transport</h4><p>JR Yamanote — <span class="tag"><i class="fa-solid fa-check"></i> JR Pass</span></p></div>
          <div class="half card"><h4>Budget</h4><p>~6 800¥ (~43€)</p></div></div>
        </div>` },
      { id: 'jour5', num: 5, title: 'Excursion à Nikko', place: 'Excursion', icon: 'fa-torii-gate', tag: 'longue', html: `
        <div class="card details"><h3><i class="fas fa-torii-gate"></i> Jour 5 — Nikko</h3>
          <p>UNESCO : Toshogu et nature. ~2h30/aller via Shinkansen + JR Nikko.</p>
          <div class="notice warning"><strong>Dernier train ~19:30</strong> (à vérifier sur place).</div>
          <div class="row"><div class="half card"><h4>Transport</h4><p>Couverts JR Pass</p></div><div class="half card"><h4>Budget</h4><p>~4 900¥ (~31€)</p></div></div>
        </div>` },
      { id: 'jour7', num: 7, title: 'Hakone', place: 'Excursion', icon: 'fa-mountain', tag: 'courte', html: `
        <div class="card details"><h3><i class="fas fa-mountain"></i> Jour 7 — Hakone</h3>
          <p>Onsen, musées, vues Fuji. ~1h30/aller. Hakone Free Pass (depuis Odawara).</p>
          <div class="row"><div class="half card"><h4>Transport</h4><p>Shinkansen → Odawara (JR), Hakone Tozan (non‑JR)</p></div><div class="half card"><h4>Budget</h4><p>~8 500¥ (~54€)</p></div></div>
        </div>` },
      { id: 'jour8', num: 8, title: 'Kyoto (Est)', place: 'Excursion', icon: 'fa-pagelines', tag: 'longue', html: `
        <div class="card details"><h3><i class="fas fa-pagelines"></i> Jour 8 — Kyoto (Est)</h3>
          <p><span class="tag"><i class="fa-solid fa-triangle-exclamation"></i> Longue journée</span> ~2h45/aller. Kiyomizu‑dera, Sannenzaka/Ninenzaka, Gion.</p>
          <div class="row"><div class="half card"><h4>Transport</h4><p>Shinkansen Hikari — couvert JR Pass</p></div><div class="half card"><h4>Budget</h4><p>~5 100¥ (~32€)</p></div></div>
        </div>` },
      { id: 'jour9', num: 9, title: 'Odaiba & teamLab', place: 'Tokyo', icon: 'fa-robot', tag: 'tokyo', html: `
        <div class="card details"><h3><i class="fas fa-robot"></i> Jour 9 — Odaiba & teamLab</h3>
          <p>Gundam Unicorn, Miraikan, vues sur la baie. teamLab (Azabudai) réservation requise.</p>
          <div class="row"><div class="half card"><h4>Transport</h4><p>JR Yamanote + Yurikamome (non‑JR)</p></div><div class="half card"><h4>Budget</h4><p>~9 230¥ (~58€)</p></div></div>
        </div>` },
      { id: 'jour11', num: 11, title: 'Kamakura', place: 'Excursion', icon: 'fa-wave-square', tag: 'courte', html: `
        <div class="card details"><h3><i class="fas fa-wave-square"></i> Jour 11 — Kamakura</h3>
          <p>Daibutsu, Hasedera, ambiance balnéaire. ~1h/aller.</p>
          <div class="row"><div class="half card"><h4>Transport</h4><p>JR Shōnan‑Shinjuku</p></div><div class="half card"><h4>Budget</h4><p>~5 500¥ (~35€)</p></div></div>
        </div>` },
      { id: 'jour12', num: 12, title: 'Kyoto (Sud) — Fushimi Inari', place: 'Excursion', icon: 'fa-torii-gate', tag: 'longue', html: `
        <div class="card details"><h3><i class="fas fa-torii-gate"></i> Jour 12 — Fushimi Inari</h3>
          <p>Randonnée à travers les torii vermillon. ~2h50/aller.</p>
          <div class="row"><div class="half card"><h4>Transport</h4><p>Shinkansen + JR Nara — couverts</p></div><div class="half card"><h4>Budget</h4><p>~3 500¥ (~22€)</p></div></div>
        </div>` },
      { id: 'jour14', num: 14, title: 'Nara', place: 'Excursion', icon: 'fa-paw', tag: 'longue', html: `
        <div class="card details"><h3><i class="fas fa-paw"></i> Jour 14 — Nara</h3>
          <p>Grands daims et Grand Bouddha. ~3h45/aller (via Kyoto).</p>
          <div class="row"><div class="half card"><h4>Transport</h4><p>Shinkansen + JR Nara — couverts</p></div><div class="half card"><h4>Budget</h4><p>~4 300¥ (~27€)</p></div></div>
        </div>` },
      { id: 'jour15', num: 15, title: "Château d'Himeji", place: 'Excursion', icon: 'fa-fort-awesome', tag: 'longue', html: `
        <div class="card details"><h3><i class="fas fa-fort-awesome"></i> Jour 15 — Himeji</h3>
          <p>Le « Héron Blanc ». ~3h30/aller.</p>
          <div class="row"><div class="half card"><h4>Transport</h4><p>Tokaido‑Sanyo (Hikari) — couvert</p></div><div class="half card"><h4>Budget</h4><p>~3 550¥ (~23€)</p></div></div>
        </div>` },
      { id: 'jour18', num: 18, title: 'Hiroshima & Miyajima', place: 'Excursion', icon: 'fa-bomb', tag: 'extreme', html: `
        <div class="card details"><h3><i class="fas fa-bomb"></i> Jour 18 — [MARATHON] Hiroshima & Miyajima</h3>
          <p>Journée la plus intense : ~5h/aller. Musée de la Paix + torii flottant.</p>
          <div class="row"><div class="half card"><h4>Transport</h4><p>Shinkansen + JR Sanyō + Ferry JR — couverts</p></div><div class="half card"><h4>Budget</h4><p>~4 400¥ (~28€)</p></div></div>
        </div>` },
      { id: 'jour20', num: 20, title: 'Derniers achats', place: 'Tokyo', icon: 'fa-gift', tag: 'tokyo', html: `
        <div class="card details"><h3><i class="fas fa-gift"></i> Jour 20 — Shopping souvenirs</h3>
          <p>Grands magasins (Isetan, Takashimaya), Loft, Tokyu Hands, Don Quijote.</p>
          <div class="row"><div class="half card"><h4>Transport</h4><p>JR Yamanote</p></div><div class="half card"><h4>Budget</h4><p>~4 000¥ (+ shopping)</p></div></div>
        </div>` },
      { id: 'jour21', num: 21, title: 'Départ', place: 'Aéroport', icon: 'fa-plane-departure', tag: 'tokyo', html: `
        <div class="card details"><h3><i class="fas fa-plane-departure"></i> Jour 21 — Départ</h3>
          <p>N'EX Shinjuku → Narita. Si JR Pass valide: couvert.</p>
          <div class="row"><div class="half card"><h4>Budget</h4><p>~1 500¥ (~10€)</p></div></div>
        </div>` },
    ];

    const SPEND = [
      [1, 5500, 35],[2,5400,34],[3,6800,43],[4,7900,50],[5,4900,31],[6,7000,44],[7,8500,54],[8,5100,32],[9,9230,58],[10,6000,38],[11,5500,35],[12,3500,22],[13,7150,45],[14,4300,27],[15,3550,23],[16,5500,35],[17,6400,41],[18,4400,28],[19,7000,44],[20,4000,25],[21,1500,10]
    ];

    // ===== Build itinerary cards =====
    const grid = document.getElementById('grid');
    const detailsRoot = document.getElementById('details');
    DAYS.sort((a,b)=>a.num-b.num).forEach(d => {
      const card = document.createElement('article');
      card.className = 'day-card';
      card.dataset.target = `#${d.id}`;
      card.dataset.tags = d.tag;
      card.innerHTML = `
        <div class="day-head"><span class="badge">Jour ${d.num}</span><span class="muted"><i class="fa-solid fa-location-dot"></i> ${d.place}</span></div>
        <div class="day-body"><div class="title">${d.title}</div><div class="kicker"><i class="fa-solid ${d.icon}"></i> Cliquer pour détails</div></div>`;
      grid.appendChild(card);

      const panel = document.createElement('div');
      panel.id = d.id;
      panel.className = 'details';
      panel.innerHTML = d.html;
      detailsRoot.appendChild(panel);

      card.addEventListener('click', ()=>{
        document.querySelectorAll('.details.visible').forEach(el=>el.classList.remove('visible'));
        panel.classList.add('visible');
        panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    });

    // ===== Filter chips =====
    const chips = document.querySelectorAll('.chip');
    chips.forEach(ch => ch.addEventListener('click', ()=>{
      chips.forEach(c=>c.classList.remove('active'));
      ch.classList.add('active');
      const key = ch.dataset.filter;
      document.querySelectorAll('.day-card').forEach(dc => {
        const show = key==='all' || dc.dataset.tags.includes(key);
        dc.style.display = show ? '' : 'none';
      });
    }));

    // ===== Back to top & progress =====
    const backToTopBtn = document.getElementById('backToTopBtn');
    const progress = document.getElementById('progressBar');
    window.addEventListener('scroll', () => {
      const y = window.scrollY;
      backToTopBtn.style.display = y > 160 ? 'inline-flex' : 'none';
      const h = document.documentElement;
      const scrolled = (h.scrollTop) / (h.scrollHeight - h.clientHeight);
      progress.style.scale = `${Math.max(scrolled, 0)} 1`;
    });
    backToTopBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

    // ===== Theme toggle (persisted) =====
    const themeToggle = document.getElementById('themeToggle');
    const applyTheme = (mode) => document.documentElement.setAttribute('data-theme', mode);
    const savedTheme = localStorage.getItem('theme-mode');
    if (savedTheme) applyTheme(savedTheme);
    themeToggle.addEventListener('click', () => {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'light' ? 'dark' : 'light';
      applyTheme(next); localStorage.setItem('theme-mode', next);
      themeToggle.innerHTML = next==='light' ? '<i class="fa-regular fa-moon"></i> Thème' : '<i class="fa-regular fa-sun"></i> Thème';
    });

    // ===== Spend table =====
    const spendRoot = document.getElementById('spendTable');
    const table = document.createElement('table');
    table.innerHTML = `<thead><tr><th>Jour</th><th>¥</th><th>€</th></tr></thead><tbody></tbody><tfoot></tfoot>`;
    const tbody = table.querySelector('tbody');
    let totalY = 0, totalE = 0;
    SPEND.forEach(([d,y,e])=>{ totalY += y; totalE += e; tbody.insertAdjacentHTML('beforeend',`<tr><td>${d}</td><td>${y.toLocaleString('fr-FR')} ¥</td><td>${e}€</td></tr>`); });
    table.querySelector('tfoot').innerHTML = `<tr><td><strong>Total</strong></td><td>${totalY.toLocaleString('fr-FR')} ¥</td><td>~${totalE}€</td></tr>`;
    spendRoot.appendChild(table);
  </script>
</body>
</html>
